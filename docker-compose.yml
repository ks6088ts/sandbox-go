version: '3'
services:
  go:
    build:
      context: .
      dockerfile: ./docker/go/Dockerfile
      args:
        - HTTP_PROXY=${COMMON_HTTP_PROXY}
        - HTTPS_PROXY=${COMMON_HTTPS_PROXY}
        - WORK_DIR=${GO_WORK_DIR}
    container_name: go
    tty: true
    volumes:
      - ./:${GO_WORK_DIR}
    environment:
      - HTTP_PROXY=${COMMON_HTTP_PROXY}
      - HTTPS_PROXY=${COMMON_HTTPS_PROXY}
  grafana:
    build:
      context: .
      dockerfile: ./docker/grafana/Dockerfile
    container_name: grafana
    env_file: ./docker/grafana/env
    environment:
      - HTTP_PROXY=${COMMON_HTTP_PROXY}
      - HTTPS_PROXY=${COMMON_HTTPS_PROXY}
    volumes:
      - ./docker/grafana/datasources:/etc/grafana/provisioning/datasources
    ports:
      - ${GRAFANA_PORT}:3000
    restart: always
    networks:
      - shared-network
  prometheus:
    image: prom/prometheus
    volumes:
      - ./docker/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
    ports:
      - ${PROMETHEUS_PORT}:9090
    networks:
      - shared-network

networks:
  shared-network:
    external: true
